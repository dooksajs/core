{"version":3,"file":"ds-plugin-template.5bfc34cc.6e8bcdc0.js","sources":["../../../../node_modules/.pnpm/bitbucket.org+dooksa+ds-plugin-manager@c394809c7933455528ddde85313e92072b269406/node_modules/@dooksa/ds-plugin-manager/dist/ds-plugin-template.5bfc34cc.js"],"sourcesContent":["const _ = {\n  name: \"dsTemplate\",\n  version: 1,\n  dependencies: [\n    {\n      name: \"dsUtilities\",\n      version: 1\n    }\n  ],\n  data: {\n    entry: {},\n    items: {},\n    components: {},\n    modifiers: {}\n  },\n  methods: {\n    create({\n      id: c,\n      entry: e,\n      sectionId: o = this.$method(\"dsUtilities/generateId\"),\n      instanceId: s,\n      groupId: v = this.$method(\"dsUtilities/generateId\"),\n      defaultContent: u,\n      modifiers: m = {},\n      view: r = \"default\",\n      head: h = !1\n    }) {\n      let g = this.items[e] || this.items[this.entry[c]];\n      return g ? this._constructor(c, e, g, o, s, v, u, m, r, h) : new Promise((w) => {\n        this._fetch(c).then(() => {\n          e = this.entry[c], g = this.items[e];\n          const t = this._constructor(c, e, g, o, s, v, u, m, r, h);\n          w(t);\n        });\n      });\n    },\n    _constructor(c, e, o, s, v, u, m, r, h, g) {\n      let w = \"\";\n      const t = {\n        layoutEntry: \"\",\n        widgets: {\n          items: {},\n          content: {},\n          layout: {}\n        },\n        content: {\n          value: {},\n          type: {}\n        }\n      };\n      if (g) {\n        const n = o.layouts[0], a = s + v + \"_\" + h, i = 0;\n        if (o.content[i]) {\n          const [d, y] = this._createContent(o.content[i], h, u, m, r), l = e + n;\n          r[l] && (t.widgets.layout = { [a]: r[l] }), t.widgets.content[a] = d, t.content = y;\n        }\n        if (o.events[i]) {\n          const d = o.events[i];\n          t.events = t.events || {};\n          for (const y in d)\n            if (Object.hasOwnProperty.call(d, y)) {\n              const l = d[y], p = v + \"_\" + y.padStart(4, \"0\");\n              for (const f in l)\n                if (Object.hasOwnProperty.call(l, f)) {\n                  const $ = l[f];\n                  t.events[p + \"_\" + f] = $;\n                }\n            }\n        }\n        w = n, this.$method(\"dsWidget/setLoaded\", { id: a, value: !0 });\n      } else\n        for (let n = 0; n < o.layouts.length; n++) {\n          const a = o.layouts[n], i = {}, d = this.$method(\"dsUtilities/generateId\"), y = s + d + \"_default\";\n          if (o.content && o.content[n]) {\n            const [l, p] = this._createContent(o.content[n], h, u, m, r), f = e + a;\n            r[f] && (t.widgets.layout || (t.widgets.layout = {}), t.widgets.layout[s + d + \"_default\"] = r[f]), t.widgets.content[y] = l, t.content.value = { ...t.content.value, ...p.value }, t.content.type = { ...t.content.type, ...p.type };\n          }\n          if (o.events[n]) {\n            const l = o.events[n];\n            t.events = t.events || {};\n            for (const p in l)\n              if (Object.hasOwnProperty.call(l, p)) {\n                const f = l[p], $ = d + \"_\" + p.padStart(4, \"0\") + \"_\" + f.on;\n                t.events[$] = f.action;\n              }\n          }\n          i.default = { id: a }, t.widgets.sections[s] ? t.widgets.sections[s].push({ groupId: u, instanceId: d, layout: i }) : t.widgets.sections[s] = [{ groupId: u, instanceId: d, layout: i }], this.$method(\"dsWidget/setLoaded\", { id: y, value: !0 });\n        }\n      if (t.events && this.$method(\"dsEvent/set\", t.events), t.content && (t.content.value && this.$method(\"dsContent/setValues\", t.content.value), t.content.type && this.$method(\"dsContent/setTypes\", t.content.type)), t.widgets && (t.widgets.sections && this.$method(\"dsWidget/setSection\", t.widgets.sections), t.widgets.layout && this.$method(\"dsWidget/setLayout\", t.widgets.layout), t.widgets.content)) {\n        const n = this.$method(\"dsRouter/getCurrentId\");\n        this.$method(\"dsWidget/setContent\", { dsPageId: n, items: t.widgets.content });\n      }\n      return [s, w, t];\n    },\n    _createContent(c, e, o, s = [], v) {\n      const u = [], m = {\n        value: {},\n        type: {}\n      };\n      for (let r = 0; r < c.length; r++) {\n        const h = c[r], [g, w] = h.type;\n        let t, n;\n        if (s.length && w)\n          for (let a = 0; a < s.length; a++) {\n            const i = s[a], d = this.$method(\"dsContent/getType\", i);\n            if (g === d[0]) {\n              t = i, s.splice(a, 1), n = !0;\n              break;\n            }\n          }\n        else\n          t = this.$method(\"dsUtilities/generateId\");\n        if (u.push(t), !n)\n          if (m.type[t] = [g, w], g === \"section\") {\n            const a = {};\n            for (let i = 0; i < h.value.length; i++) {\n              const [d, y] = h.value[i], [l] = this.create({ entry: y, defaultContent: s, groupId: o, view: e, modifiers: v });\n              a[d] = l;\n            }\n            m.value[t] = a;\n          } else\n            m.value[t] = h.value;\n      }\n      return [u, m, s];\n    },\n    _fetch(c) {\n      return new Promise((e, o) => {\n        this.$action(\n          \"dsDatabase/getOne\",\n          { collection: \"widgetTemplates\", id: c },\n          {\n            onSuccess: (s) => {\n              this.set({ id: s.id, item: s }), e(s);\n            },\n            onError: (s) => {\n              console.error(s), o(s);\n            }\n          }\n        );\n      });\n    },\n    set({ id: c, item: e }) {\n      this.entry[c] = e.templateEntry, e.template && (this.items = { ...this.items, ...e.template }), e.modifiers && (this.modifiers[c] = e.modifiers), e.layouts && (this.$method(\"dsLayout/setItems\", e.layouts.items), e.layouts.head && this.$method(\"dsLayout/setHead\", e.layouts.head)), e.components && this.$method(\"dsComponent/set\", e.components);\n    }\n  }\n};\nexport {\n  _ as default\n};\n"],"names":["c","o","r","h","g","n","a","i","y"],"mappings":"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"}