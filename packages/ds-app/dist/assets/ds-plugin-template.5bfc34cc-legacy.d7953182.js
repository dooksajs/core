System.register([],(function(t,e){"use strict";return{execute:function(){t("default",{name:"dsTemplate",version:1,dependencies:[{name:"dsUtilities",version:1}],data:{entry:{},items:{},components:{},modifiers:{}},methods:{create({id:t,entry:e,sectionId:s=this.$method("dsUtilities/generateId"),instanceId:n,groupId:o=this.$method("dsUtilities/generateId"),defaultContent:i,modifiers:d={},view:c="default",head:a=!1}){let r=this.items[e]||this.items[this.entry[t]];return r?this._constructor(t,e,r,s,n,o,i,d,c,a):new Promise((l=>{this._fetch(t).then((()=>{e=this.entry[t],r=this.items[e];const h=this._constructor(t,e,r,s,n,o,i,d,c,a);l(h)}))}))},_constructor(t,e,s,n,o,i,d,c,a,r){let l="";const h={layoutEntry:"",widgets:{items:{},content:{},layout:{}},content:{value:{},type:{}}};if(r){const t=s.layouts[0],r=n+o+"_"+a,u=0;if(s.content[u]){const[n,o]=this._createContent(s.content[u],a,i,d,c),l=e+t;c[l]&&(h.widgets.layout={[r]:c[l]}),h.widgets.content[r]=n,h.content=o}if(s.events[u]){const t=s.events[u];h.events=h.events||{};for(const e in t)if(Object.hasOwnProperty.call(t,e)){const s=t[e],n=o+"_"+e.padStart(4,"0");for(const t in s)if(Object.hasOwnProperty.call(s,t)){const e=s[t];h.events[n+"_"+t]=e}}}l=t,this.$method("dsWidget/setLoaded",{id:r,value:!0})}else for(let u=0;u<s.layouts.length;u++){const t=s.layouts[u],o={},r=this.$method("dsUtilities/generateId"),l=n+r+"_default";if(s.content&&s.content[u]){const[o,m]=this._createContent(s.content[u],a,i,d,c),y=e+t;c[y]&&(h.widgets.layout||(h.widgets.layout={}),h.widgets.layout[n+r+"_default"]=c[y]),h.widgets.content[l]=o,h.content.value={...h.content.value,...m.value},h.content.type={...h.content.type,...m.type}}if(s.events[u]){const t=s.events[u];h.events=h.events||{};for(const e in t)if(Object.hasOwnProperty.call(t,e)){const s=t[e],n=r+"_"+e.padStart(4,"0")+"_"+s.on;h.events[n]=s.action}}o.default={id:t},h.widgets.sections[n]?h.widgets.sections[n].push({groupId:i,instanceId:r,layout:o}):h.widgets.sections[n]=[{groupId:i,instanceId:r,layout:o}],this.$method("dsWidget/setLoaded",{id:l,value:!0})}if(h.events&&this.$method("dsEvent/set",h.events),h.content&&(h.content.value&&this.$method("dsContent/setValues",h.content.value),h.content.type&&this.$method("dsContent/setTypes",h.content.type)),h.widgets&&(h.widgets.sections&&this.$method("dsWidget/setSection",h.widgets.sections),h.widgets.layout&&this.$method("dsWidget/setLayout",h.widgets.layout),h.widgets.content)){const t=this.$method("dsRouter/getCurrentId");this.$method("dsWidget/setContent",{dsPageId:t,items:h.widgets.content})}return[n,l,h]},_createContent(t,e,s,n=[],o){const i=[],d={value:{},type:{}};for(let c=0;c<t.length;c++){const a=t[c],[r,l]=a.type;let h,u;if(n.length&&l)for(let t=0;t<n.length;t++){const e=n[t];if(r===this.$method("dsContent/getType",e)[0]){h=e,n.splice(t,1),u=!0;break}}else h=this.$method("dsUtilities/generateId");if(i.push(h),!u)if(d.type[h]=[r,l],"section"===r){const t={};for(let i=0;i<a.value.length;i++){const[d,c]=a.value[i],[r]=this.create({entry:c,defaultContent:n,groupId:s,view:e,modifiers:o});t[d]=r}d.value[h]=t}else d.value[h]=a.value}return[i,d,n]},_fetch(t){return new Promise(((e,s)=>{this.$action("dsDatabase/getOne",{collection:"widgetTemplates",id:t},{onSuccess:t=>{this.set({id:t.id,item:t}),e(t)},onError:t=>{console.error(t),s(t)}})}))},set({id:t,item:e}){this.entry[t]=e.templateEntry,e.template&&(this.items={...this.items,...e.template}),e.modifiers&&(this.modifiers[t]=e.modifiers),e.layouts&&(this.$method("dsLayout/setItems",e.layouts.items),e.layouts.head&&this.$method("dsLayout/setHead",e.layouts.head)),e.components&&this.$method("dsComponent/set",e.components)}}})}}}));
//# sourceMappingURL=ds-plugin-template.5bfc34cc-legacy.d7953182.js.map
