{
  "metadata": [
    {
      "id": "bootstrap-edit-section-card",
      "name": "Bootstrap card"
    }
  ],
  "actions": [
    {
      "id": "bootstrap-open-section-editor",
      "sequence": [
        { 
          "description": "Get widget group id",
          "get/dataValue": {
            "name": "widget/items",
            "id": {
              "get/contextValue": "widgetId"
            }
          }
        },
        {
          "description": "Create modal",
          "async": true,
          "template/create": {
            "id": "bootstrap-modal",
            "widgetOptions": {
              "groupId": {
                "get/sequenceValue": "0"
              }
            }
          }
        },
        {
          "description": "Create action value key",
          "operator/eval": {
            "name": "+",
            "values": [
              {
                "widget/attachedToIndex": {
                  "get/contextValue": ["widgetId"]
                }
              },
              "__bootstrap-edit-section-template-id"
            ]
          }
        },
        {
          "description": "Fetch template metadata",
          "async": true,
          "database/getById": {
            "collection": "template/metadata",
            "id": {
              "get/actionValue": {
                "id": {
                  "get/sequenceValue": "0"
                },
                "keys": [{
                  "get/sequenceValue": "2"
                }]
              }
            }
          }
        },
        {
          "description": "Set template metadata",
          "set/actionValue": {
            "id": {
              "get/sequenceValue": "0"
            },
            "values": [
              {
                "id": "bootstrap-edit-section-template",
                "value": {
                  "get/sequenceValue": "3"
                }
              }
            ]
          }
        },
        {
          "set/dataValue": {
            "name": "section/items",
            "value": {
              "get/sequenceValue": "1"
            },
            "options": {
              "id": {
                "router/currentId": "$noArgs"
              },
              "update": {
                "method": "unshift"
              }
            }
          }
        }
      ]
    },
    {
      "id": "bootstrap-edit-section",
      "dependencies": ["bootstrap-edit-section-iterate"],
      "sequence": [
        {
          "get/dataValue": {
            "name": "section/items",
            "id": {
              "get/contextValue": ["sectionId"]
            }
          }
        },
        {
          "eval/condition": {
            "if": [{
              "op": ">",
              "from": {
                "get/blockValue": {
                  "value": {
                    "get/sequenceValue": "0"
                  },
                  "map": ["length"]
                }
              },
              "to": 0
            }],
            "then": [2, 3 ,4],
            "else": []
          }
        },
        { 
          "async": true,
          "list/forEach": {
            "async": true,
            "items": {
              "get/sequenceValue": 0
            },
            "context": {
              "get/contextValue": "$noArgs"
            },
            "actionId": "bootstrap-edit-section-iterate"
          }
        },
        {
          "section/set": {
            "value": {
              "get/sequenceValue": "2"
            },
            "options": {
              "stopPropagation": true,
              "id": {
                "get/contextValue": ["sectionId"]
              }
            }
          }
        },
        {
          "section/render": {
            "id": {
              "get/contextValue": ["sectionId"]
            },
            "viewId": {
              "get/contextValue": ["viewId"]
            }
          }
        }     
      ]
    },
    {
      "id": "bootstrap-edit-section-iterate",
      "sequence": [
        {
          "description": "Widget template id",
          "get/dataValue": {
            "name": "widget/templates",
            "id": {
              "get/payloadValue": "value"
            }
          }
        },
        {
          "description": "Replace current widget with 'bootstrap-edit-section-link'",
          "eval/condition": {
            "if": [
              {
                "op": "!=",
                "from": {
                  "get/sequenceValue": "0"
                },
                "to": "bootstrap-edit-section-link"
              }
            ],
            "then": [2, 3, 4, 5, 6],
            "else": []
          }
        },
        {
          "get/dataValue": {
            "name": "widget/items",
            "id": {
              "get/payloadValue": "value"
            }
          }
        },
        {
          "description": "Create edit link template",
          "async": true,
          "template/create": {
            "id": "bootstrap-edit-section-link",
            "widgetOptions": {
              "groupId": {
                "get/sequenceValue": "2"
              }
            }
          }
        },
        {
          "description": "Set current template into action value",
          "set/actionValue": {
            "id": {
              "get/sequenceValue": "2"
            },
            "values": [
              {
                "id": {
                  "operator/eval": {
                    "name": "+",
                    "values": [
                      {
                        "get/payloadValue": "key"
                      },
                      "__bootstrap-edit-section-template-id"
                    ]
                  }
                },
                "value": {
                  "get/sequenceValue": "0"
                }
              }
            ]
          }
        },
        {
          "description": "Add current widget to edit link section",
          "section/set": {
            "value": {
              "get/payloadValue": "value"
            },
            "options": {
              "id": {
                "get/dataValue": {
                  "name": "widget/sections",
                  "id": {
                    "get/sequenceValue": "3"
                  },
                  "options": {
                    "position": 0
                  }
                }
              },
              "update": {
                "method": "push"
              }
            }
          }
        },
        {
          "description": "Add edit section link to parent list",
          "list/push": {
            "target": {
              "get/contextValue": "_list_"
            },
            "source": {
              "get/sequenceValue": "3"
            }
          }
        }
      ]
    }
  ]
}