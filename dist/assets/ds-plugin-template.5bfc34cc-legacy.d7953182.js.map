{"version":3,"file":"ds-plugin-template.5bfc34cc-legacy.d7953182.js","sources":["../../../../node_modules/.pnpm/bitbucket.org+dooksa+ds-plugin-manager@c394809c7933455528ddde85313e92072b269406/node_modules/@dooksa/ds-plugin-manager/dist/ds-plugin-template.5bfc34cc.js"],"sourcesContent":["const _ = {\n  name: \"dsTemplate\",\n  version: 1,\n  dependencies: [\n    {\n      name: \"dsUtilities\",\n      version: 1\n    }\n  ],\n  data: {\n    entry: {},\n    items: {},\n    components: {},\n    modifiers: {}\n  },\n  methods: {\n    create({\n      id: c,\n      entry: e,\n      sectionId: o = this.$method(\"dsUtilities/generateId\"),\n      instanceId: s,\n      groupId: v = this.$method(\"dsUtilities/generateId\"),\n      defaultContent: u,\n      modifiers: m = {},\n      view: r = \"default\",\n      head: h = !1\n    }) {\n      let g = this.items[e] || this.items[this.entry[c]];\n      return g ? this._constructor(c, e, g, o, s, v, u, m, r, h) : new Promise((w) => {\n        this._fetch(c).then(() => {\n          e = this.entry[c], g = this.items[e];\n          const t = this._constructor(c, e, g, o, s, v, u, m, r, h);\n          w(t);\n        });\n      });\n    },\n    _constructor(c, e, o, s, v, u, m, r, h, g) {\n      let w = \"\";\n      const t = {\n        layoutEntry: \"\",\n        widgets: {\n          items: {},\n          content: {},\n          layout: {}\n        },\n        content: {\n          value: {},\n          type: {}\n        }\n      };\n      if (g) {\n        const n = o.layouts[0], a = s + v + \"_\" + h, i = 0;\n        if (o.content[i]) {\n          const [d, y] = this._createContent(o.content[i], h, u, m, r), l = e + n;\n          r[l] && (t.widgets.layout = { [a]: r[l] }), t.widgets.content[a] = d, t.content = y;\n        }\n        if (o.events[i]) {\n          const d = o.events[i];\n          t.events = t.events || {};\n          for (const y in d)\n            if (Object.hasOwnProperty.call(d, y)) {\n              const l = d[y], p = v + \"_\" + y.padStart(4, \"0\");\n              for (const f in l)\n                if (Object.hasOwnProperty.call(l, f)) {\n                  const $ = l[f];\n                  t.events[p + \"_\" + f] = $;\n                }\n            }\n        }\n        w = n, this.$method(\"dsWidget/setLoaded\", { id: a, value: !0 });\n      } else\n        for (let n = 0; n < o.layouts.length; n++) {\n          const a = o.layouts[n], i = {}, d = this.$method(\"dsUtilities/generateId\"), y = s + d + \"_default\";\n          if (o.content && o.content[n]) {\n            const [l, p] = this._createContent(o.content[n], h, u, m, r), f = e + a;\n            r[f] && (t.widgets.layout || (t.widgets.layout = {}), t.widgets.layout[s + d + \"_default\"] = r[f]), t.widgets.content[y] = l, t.content.value = { ...t.content.value, ...p.value }, t.content.type = { ...t.content.type, ...p.type };\n          }\n          if (o.events[n]) {\n            const l = o.events[n];\n            t.events = t.events || {};\n            for (const p in l)\n              if (Object.hasOwnProperty.call(l, p)) {\n                const f = l[p], $ = d + \"_\" + p.padStart(4, \"0\") + \"_\" + f.on;\n                t.events[$] = f.action;\n              }\n          }\n          i.default = { id: a }, t.widgets.sections[s] ? t.widgets.sections[s].push({ groupId: u, instanceId: d, layout: i }) : t.widgets.sections[s] = [{ groupId: u, instanceId: d, layout: i }], this.$method(\"dsWidget/setLoaded\", { id: y, value: !0 });\n        }\n      if (t.events && this.$method(\"dsEvent/set\", t.events), t.content && (t.content.value && this.$method(\"dsContent/setValues\", t.content.value), t.content.type && this.$method(\"dsContent/setTypes\", t.content.type)), t.widgets && (t.widgets.sections && this.$method(\"dsWidget/setSection\", t.widgets.sections), t.widgets.layout && this.$method(\"dsWidget/setLayout\", t.widgets.layout), t.widgets.content)) {\n        const n = this.$method(\"dsRouter/getCurrentId\");\n        this.$method(\"dsWidget/setContent\", { dsPageId: n, items: t.widgets.content });\n      }\n      return [s, w, t];\n    },\n    _createContent(c, e, o, s = [], v) {\n      const u = [], m = {\n        value: {},\n        type: {}\n      };\n      for (let r = 0; r < c.length; r++) {\n        const h = c[r], [g, w] = h.type;\n        let t, n;\n        if (s.length && w)\n          for (let a = 0; a < s.length; a++) {\n            const i = s[a], d = this.$method(\"dsContent/getType\", i);\n            if (g === d[0]) {\n              t = i, s.splice(a, 1), n = !0;\n              break;\n            }\n          }\n        else\n          t = this.$method(\"dsUtilities/generateId\");\n        if (u.push(t), !n)\n          if (m.type[t] = [g, w], g === \"section\") {\n            const a = {};\n            for (let i = 0; i < h.value.length; i++) {\n              const [d, y] = h.value[i], [l] = this.create({ entry: y, defaultContent: s, groupId: o, view: e, modifiers: v });\n              a[d] = l;\n            }\n            m.value[t] = a;\n          } else\n            m.value[t] = h.value;\n      }\n      return [u, m, s];\n    },\n    _fetch(c) {\n      return new Promise((e, o) => {\n        this.$action(\n          \"dsDatabase/getOne\",\n          { collection: \"widgetTemplates\", id: c },\n          {\n            onSuccess: (s) => {\n              this.set({ id: s.id, item: s }), e(s);\n            },\n            onError: (s) => {\n              console.error(s), o(s);\n            }\n          }\n        );\n      });\n    },\n    set({ id: c, item: e }) {\n      this.entry[c] = e.templateEntry, e.template && (this.items = { ...this.items, ...e.template }), e.modifiers && (this.modifiers[c] = e.modifiers), e.layouts && (this.$method(\"dsLayout/setItems\", e.layouts.items), e.layouts.head && this.$method(\"dsLayout/setHead\", e.layouts.head)), e.components && this.$method(\"dsComponent/set\", e.components);\n    }\n  }\n};\nexport {\n  _ as default\n};\n"],"names":["exports","name","version","dependencies","data","entry","items","components","modifiers","methods","create","id","c","e","sectionId","o","this","$method","instanceId","s","groupId","v","defaultContent","u","m","view","r","head","h","g","_constructor","Promise","w","_fetch","then","t","layoutEntry","widgets","content","layout","value","type","layouts","a","i","d","y","_createContent","l","n","events","Object","hasOwnProperty","call","p","padStart","f","$","length","on","action","default","sections","push","dsPageId","splice","$action","collection","onSuccess","set","item","onError","console","error","templateEntry","template"],"mappings":"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"}