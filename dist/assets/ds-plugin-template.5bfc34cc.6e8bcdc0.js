const _={name:"dsTemplate",version:1,dependencies:[{name:"dsUtilities",version:1}],data:{entry:{},items:{},components:{},modifiers:{}},methods:{create({id:a,entry:e,sectionId:n=this.$method("dsUtilities/generateId"),instanceId:s,groupId:v=this.$method("dsUtilities/generateId"),defaultContent:u,modifiers:m={},view:h="default",head:r=!1}){let y=this.items[e]||this.items[this.entry[a]];return y?this._constructor(a,e,y,n,s,v,u,m,h,r):new Promise(w=>{this._fetch(a).then(()=>{e=this.entry[a],y=this.items[e];const t=this._constructor(a,e,y,n,s,v,u,m,h,r);w(t)})})},_constructor(a,e,n,s,v,u,m,h,r,y){let w="";const t={layoutEntry:"",widgets:{items:{},content:{},layout:{}},content:{value:{},type:{}}};if(y){const i=n.layouts[0],c=s+v+"_"+r,o=0;if(n.content[o]){const[d,g]=this._createContent(n.content[o],r,u,m,h),l=e+i;h[l]&&(t.widgets.layout={[c]:h[l]}),t.widgets.content[c]=d,t.content=g}if(n.events[o]){const d=n.events[o];t.events=t.events||{};for(const g in d)if(Object.hasOwnProperty.call(d,g)){const l=d[g],p=v+"_"+g.padStart(4,"0");for(const f in l)if(Object.hasOwnProperty.call(l,f)){const $=l[f];t.events[p+"_"+f]=$}}}w=i,this.$method("dsWidget/setLoaded",{id:c,value:!0})}else for(let i=0;i<n.layouts.length;i++){const c=n.layouts[i],o={},d=this.$method("dsUtilities/generateId"),g=s+d+"_default";if(n.content&&n.content[i]){const[l,p]=this._createContent(n.content[i],r,u,m,h),f=e+c;h[f]&&(t.widgets.layout||(t.widgets.layout={}),t.widgets.layout[s+d+"_default"]=h[f]),t.widgets.content[g]=l,t.content.value={...t.content.value,...p.value},t.content.type={...t.content.type,...p.type}}if(n.events[i]){const l=n.events[i];t.events=t.events||{};for(const p in l)if(Object.hasOwnProperty.call(l,p)){const f=l[p],$=d+"_"+p.padStart(4,"0")+"_"+f.on;t.events[$]=f.action}}o.default={id:c},t.widgets.sections[s]?t.widgets.sections[s].push({groupId:u,instanceId:d,layout:o}):t.widgets.sections[s]=[{groupId:u,instanceId:d,layout:o}],this.$method("dsWidget/setLoaded",{id:g,value:!0})}if(t.events&&this.$method("dsEvent/set",t.events),t.content&&(t.content.value&&this.$method("dsContent/setValues",t.content.value),t.content.type&&this.$method("dsContent/setTypes",t.content.type)),t.widgets&&(t.widgets.sections&&this.$method("dsWidget/setSection",t.widgets.sections),t.widgets.layout&&this.$method("dsWidget/setLayout",t.widgets.layout),t.widgets.content)){const i=this.$method("dsRouter/getCurrentId");this.$method("dsWidget/setContent",{dsPageId:i,items:t.widgets.content})}return[s,w,t]},_createContent(a,e,n,s=[],v){const u=[],m={value:{},type:{}};for(let h=0;h<a.length;h++){const r=a[h],[y,w]=r.type;let t,i;if(s.length&&w)for(let c=0;c<s.length;c++){const o=s[c],d=this.$method("dsContent/getType",o);if(y===d[0]){t=o,s.splice(c,1),i=!0;break}}else t=this.$method("dsUtilities/generateId");if(u.push(t),!i)if(m.type[t]=[y,w],y==="section"){const c={};for(let o=0;o<r.value.length;o++){const[d,g]=r.value[o],[l]=this.create({entry:g,defaultContent:s,groupId:n,view:e,modifiers:v});c[d]=l}m.value[t]=c}else m.value[t]=r.value}return[u,m,s]},_fetch(a){return new Promise((e,n)=>{this.$action("dsDatabase/getOne",{collection:"widgetTemplates",id:a},{onSuccess:s=>{this.set({id:s.id,item:s}),e(s)},onError:s=>{console.error(s),n(s)}})})},set({id:a,item:e}){this.entry[a]=e.templateEntry,e.template&&(this.items={...this.items,...e.template}),e.modifiers&&(this.modifiers[a]=e.modifiers),e.layouts&&(this.$method("dsLayout/setItems",e.layouts.items),e.layouts.head&&this.$method("dsLayout/setHead",e.layouts.head)),e.components&&this.$method("dsComponent/set",e.components)}}};export{_ as default};
//# sourceMappingURL=ds-plugin-template.5bfc34cc.6e8bcdc0.js.map
